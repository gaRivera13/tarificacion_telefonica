<div class="main-container" role="main">
    <aside aria-label="Menú lateral de navegación" [ngClass]="{ visible: sidebarVisible }" id="sidebar">
      <div class="section-title" *ngIf="rol === 'admin'">GESTIONES</div>

      <button *ngIf="rol === 'admin'" [routerLink]="['/menu-principal/gestion-facultad']" type="button" tabindex="0">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#5AA8D6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
          <rect x="3" y="4" width="18" height="16" rx="2" />
          <path d="M3 10h18" />
        </svg>
        <span>Cuentas presupuestarias</span>
      </button>

      <button *ngIf="rol === 'admin'" [routerLink]="['/menu-principal/gestion-unidades']" type="button" tabindex="0">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#5AA8D6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
          <rect x="3" y="4" width="18" height="16" rx="2" />
          <path d="M9 4v16M15 4v16" />
        </svg>
        <span>Departamentos</span>
      </button>

      <button *ngIf="rol === 'admin'" [routerLink]="['/menu-principal/gestion-usuarios']" type="button" tabindex="0">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#5AA8D6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
          <circle cx="12" cy="8" r="4"/>
          <path d="M4 20c0-4 8-4 8-4s8 0 8 4"/>
        </svg>
        <span>Usuarios</span>
      </button>

      <button *ngIf="rol === 'admin'" [routerLink]="['/menu-principal/gestion-proveedores']" type="button" tabindex="0">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#5AA8D6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
          <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.86 19.86 0 0 1-8.63-3.07A19.5 19.5 0 0 1 3.15 8.81 19.86 19.86 0 0 1 .18 2.18 2 2 0 0 1 2.16.18h3a2 2 0 0 1 2 1.72c.13 1.05.37 2.07.72 3.06a2 2 0 0 1-.45 2.11l-1.27 1.27a16 16 0 0 0 6.29 6.29l1.27-1.27a2 2 0 0 1 2.11-.45c.99.35 2.01.59 3.06.72A2 2 0 0 1 22 16.92z"/>
        </svg>
        <span>Proveedores de telefonía</span>
      </button>

      <button *ngIf="rol === 'admin'" [routerLink]="['/menu-principal/gestion-anexos']" type="button" tabindex="0">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#5AA8D6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
          <rect x="4" y="4" width="16" height="16" rx="2"/>
          <path d="M8 2v4M16 2v4M2 10h20"/>
        </svg>
        <span>Anexos</span>
      </button>

      <div class="section-title">Consultas y procesos</div>

      <button *ngIf="rol === 'admin'" [routerLink]="['/menu-principal/calculo-reportes']" type="button" tabindex="0">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#5AA8D6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
          <rect x="3" y="4" width="18" height="16" rx="2"/>
          <path d="M16 2v4M8 2v4M3 10h18"/>
        </svg>
        <span>Cálculo de reportes</span>
      </button>

      <button *ngIf="rol === 'admin' || rol === 'encargado'" [routerLink]="['/menu-principal/consulta-reportes']" type="button" tabindex="0">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#5AA8D6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
          <rect x="3" y="4" width="18" height="16" rx="2"/>
          <path d="M16 2v4M8 2v4M3 10h18"/>
        </svg>
        <span>Consulta de reportes</span>
      </button>

      <button *ngIf="rol === 'admin' || rol === 'encargado'" [routerLink]="['/menu-principal/consulta-trafico']" type="button" tabindex="0">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#5AA8D6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
          <rect x="3" y="4" width="18" height="16" rx="2"/>
          <path d="M16 2v4M8 2v4M3 10h18"/>
        </svg>
        <span>Consulta de tráfico</span>
      </button>
    </aside>

    <main aria-label="Contenido principal">
      <header>
        <button aria-label="Abrir menú"
                class="hamburger-btn"
                [attr.aria-expanded]="sidebarVisible"
                aria-controls="sidebar"
                type="button"
                (click)="toggleSidebar()">
          &#9776;
        </button>
        <div class="header-left">
          <span class="role-label">{{ rol === 'admin' ? 'Administrador' : 'Encargado' }}</span>
          <button aria-label="Notificaciones"
                  class="notification-container"
                  tabindex="0"
                  title="Notificaciones"
                  type="button">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24" width="18" height="18" aria-hidden="true" focusable="false" role="img">
              <path d="M18 8a6 6 0 0 0-12 0c0 7-3 9-3 9h18s-3-2-3-9"></path>
              <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
            </svg>
            <span class="notification-badge" aria-hidden="true"></span>
          </button>
        </div>
        <div class="profile-container">
          <button
            aria-label="Perfil de usuario - ir a página de perfil"
            type="button"
            class="profile-btn"
            (click)="toggleLogoutMenu()"
            aria-haspopup="true"
            [attr.aria-expanded]="showLogoutMenu ? 'true' : 'false'">
            <img
              alt="Icono de usuario redondo con fondo azul y silueta blanca"
              src="https://storage.googleapis.com/a1aa/image/60da4d8f-f031-4c4e-3af8-02f83b828ecb.jpg"
              height="34"
              width="34"
            />
          </button>
          <div
            class="logout-menu"
            [ngClass]="{ show: showLogoutMenu }"
            role="menu"
            tabindex="-1"
            (click)="logout()">
            <span class="fas fa-sign-out-alt" style="font-size: 1.25rem;"></span>
            <span>Cerrar sesión</span>
          </div>
        </div>
      </header>

      <section class="content" tabindex="0">
        <router-outlet></router-outlet>
      </section>
    </main>
  </div>

  <script>
    const profileBtn = document.getElementById('profileBtn');
    const logoutMenu = document.getElementById('logoutMenu');
    const notificationBtn = document.getElementById('notificationBtn');
    const notificationBadge = document.getElementById('notificationBadge');
    const hamburgerBtn = document.getElementById('hamburgerBtn');
    const sidebar = document.getElementById('sidebar');

    let hasNotifications = true; 
    if (hasNotifications) {
      notificationBadge.style.display = 'block';
    } else {
      notificationBadge.style.display = 'none';
    }

    profileBtn.addEventListener('click', () => {
      const isVisible = logoutMenu.classList.contains('show');
      if (isVisible) {
        logoutMenu.classList.remove('show');
        profileBtn.setAttribute('aria-expanded', 'false');
      } else {
        logoutMenu.classList.add('show');
        profileBtn.setAttribute('aria-expanded', 'true');
      }
    });

    hamburgerBtn.addEventListener('click', () => {
      const isVisible = sidebar.classList.contains('visible');
      if (isVisible) {
        sidebar.classList.remove('visible');
        hamburgerBtn.setAttribute('aria-expanded', 'false');
      } else {
        sidebar.classList.add('visible');
        hamburgerBtn.setAttribute('aria-expanded', 'true');
      }
    });

    document.addEventListener('click', (e) => {
      if (!profileBtn.contains(e.target) && !logoutMenu.contains(e.target)) {
        logoutMenu.classList.remove('show');
        profileBtn.setAttribute('aria-expanded', 'false');
      }
      if (!sidebar.contains(e.target) && !hamburgerBtn.contains(e.target)) {
        sidebar.classList.remove('visible');
        hamburgerBtn.setAttribute('aria-expanded', 'false');
      }
    });

    logoutMenu.addEventListener('click', () => {
      alert('Cerrar sesión'); 
    });

    notificationBtn.addEventListener('click', () => {
      alert('Aquí irían las notificaciones'); 
    });
  </script>
